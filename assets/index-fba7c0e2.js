(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function a(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(t){if(t.ep)return;t.ep=!0;const s=a(t);fetch(t.href,s)}})();const P="https://api.weatherapi.com/v1/forecast.json?key=f5db50c8f48740e4b25192615230405&q=";async function C(e,n){const o=await(await fetch(`${P}${e},${n}&days=3&aqi=no&alerts=no`)).json();try{return o}catch(t){console.log(t)}}const E=[{value:"sun",label:"Sunny"},{value:"snow",label:"Snowy"},{value:"storm",label:"Stormy"},{value:"fog",label:"Foggy"},{value:"rain",label:"Rainy"}],u=document.getElementById("dropdown");E.forEach(e=>{const n=document.createElement("option");n.value=e.value,n.text=e.label,u.appendChild(n)});const S=document.getElementById("weather-img");u.addEventListener("click",()=>{I(u.value)});I(u.value);function I(e){const n=document.getElementById("body-background"),a=`/where-weather/${e}.png`;S.setAttribute("src",a);const o="background-img ";e==="sun"?n.setAttribute("class",o+"sun"):e==="snow"?n.setAttribute("class",o+"snow"):e==="fog"?n.setAttribute("class",o+"fog"):e==="rain"?n.setAttribute("class",o+"rain"):n.setAttribute("class",o+"storm")}const L=[];async function M(){const n=await(await fetch("/where-weather/data/weather_conditions.csv")).text();try{n.split(`
`).forEach(o=>{const t=E.find(s=>o.toLowerCase().includes(s.value)||o.toLowerCase().includes("drizzle")&&s.value==="rain"||o.toLowerCase().includes("shower")&&s.value==="rain"||o.toLowerCase().includes("clear")&&s.value==="sun");t&&L.push({code:o.substring(0,o.indexOf(",")),matchingOption:t.value==="drizzle"||t.value==="shower"?"rain":t.value==="clear"?"sun":t.value})})}catch(a){console.log(a)}}M();function x(){return L.filter(e=>e.matchingOption===u.options[u.selectedIndex].value)}function h(e){return x().some(a=>a.code==e)}const B="https://wft-geo-db.p.rapidapi.com/v1/geo/cities/",T={method:"GET",headers:{"X-RapidAPI-Key":"5bd5ff9b6fmsh96b605a63af7d22p1a63f1jsncf17219368d7","X-RapidAPI-Host":"wft-geo-db.p.rapidapi.com"}},A="200000";async function H(e){var n;try{const o=await(await fetch(`${B}?namePrefix=${e}&limit=5&minPopulation=${A}`,T)).text(),t=JSON.parse(o);return(n=t==null?void 0:t.data)==null?void 0:n.map(r=>({id:r.wikiDataId,name:r.name,country:r.country,lat:r.latitude,lon:r.longitude}))}catch(a){console.error(a)}}async function F(e,n){var a;try{const t=await(await fetch(`${B}${e}/nearbyCities?radius=${n}&minPopulation=${A-5e4}&distanceUnit=mi`,T)).text(),s=JSON.parse(t),r=[];return(a=s==null?void 0:s.data)==null||a.forEach(i=>{r.push({id:i.wikiDataId,name:i.name,country:i.country,lat:i.latitude,lon:i.longitude})}),r}catch(o){console.error(o)}}let m=[],d=[];const l=document.getElementById("city-text-box"),c=document.getElementById("datalist");let p=!1;l.addEventListener("input",()=>{const e=l.value;for(let n=0;n<c.options.length;n++)if(c.options[n].text===e){const o=c.options[n].coords.split(",");d=[o[0].trim(),o[1].trim(),c.options[n].cityId.trim()];return}e.length>3&&!p&&R(e),e.length<=3&&W(),d=[]});function W(){for(;c.firstChild;)c.removeChild(c.firstChild)}async function R(e){if(!p)try{_(),m=await H(e),m==null||m.forEach(n=>{for(let o=0;o<c.options.length;o++)if(c.options[o].cityId===`${n.id}`)return;const a=document.createElement("option");a.text=`${n.name}, ${n.country}`,a.coords=`${n.lat}, ${n.lon}`,a.cityId=`${n.id}`,c.appendChild(a)})}catch(n){console.log(n)}}function _(){p=!0,setTimeout(()=>{p=!1},600)}x();const z=document.getElementById("submit");z.addEventListener("click",D);const j=document.getElementById("response-body"),q=document.getElementById("forecast-container"),g=q.getElementsByClassName("forecast-day"),v=document.getElementById("forecast-header"),w=document.getElementById("celsius"),U=document.getElementById("fahrenheit");w.addEventListener("change",k);U.addEventListener("change",k);async function D(){if(d==null||d.length===0){f("Please enter a valid city.");return}K();const e=await C(d[0],d[1]),n=e.current.condition.code,a=h(`${n}`),o=u.options[u.selectedIndex].label;if(f(`Searching for the nearest city with ${o} weather...`),a)f(`Woo! Looks like ${l.value} is already ${o}.`),y(e,l.value);else{const t=e.forecast.forecastday[0].day.condition.code;if(h(`${t}`))f(`At some time today, ${l.value} will be ${o}.`),y(e,l.value);else{const r=await F(d[2],"100");for(let i=0;i<r.length;i++){const b=await C(r[i].lat,r[i].lon),N=b.current.condition.code,O=b.forecast.forecastday[0].day.condition.code;if(h(N)||h(O)){f(`You can find ${o} weather in the nearby city of ${r[i].name}.`),y(b,`${r[i].name}, ${r[i].country}`);return}}f(`No nearby cities with ${o} weather.`),y(e,l.value)}}}function k(){l.value!==""&&D()}function f(e){j.innerHTML=e}function y(e,n){v.innerHTML=`Forecast for ${n}`,v.removeAttribute("hidden");const a=e.forecast.forecastday,o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];for(let t=0;t<a.length;t++){if(t===0){$(g[t],"Today",w.checked?a[t].day.avgtemp_c:a[t].day.avgtemp_f,a[t].day.condition.text,e.current.condition.text);continue}setTimeout(()=>{const s=new Date(a[t].date);$(g[t],o[s.getDay()],w.checked?a[t].day.avgtemp_c:a[t].day.avgtemp_f,a[t].day.condition.text)},t*25)}}function $(e,n,a,o,t){t!=null&&t!=""&&(e.getElementsByClassName("current-weather")[0].innerHTML=`Currently ${t}`),e.getElementsByClassName("day-header")[0].innerHTML=n,w.checked?e.getElementsByClassName("temp")[0].innerHTML=a+" °C":e.getElementsByClassName("temp")[0].innerHTML=a+" °F",e.getElementsByClassName("weather")[0].innerHTML=o,e.removeAttribute("hidden")}function K(){v.setAttribute("hidden","");for(let e=0;e<g.length;e++)g[e].setAttribute("hidden","")}
