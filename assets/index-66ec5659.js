(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function a(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=a(n);fetch(n.href,s)}})();const D="http://api.weatherapi.com/v1/forecast.json?key=f5db50c8f48740e4b25192615230405&q=";async function C(e,t){const o=await(await fetch(`${D}${e},${t}&days=7&aqi=no&alerts=no`)).json();try{return o}catch(n){console.log(n)}}const E=[{value:"sun",label:"Sunny"},{value:"rain",label:"Rainy"},{value:"storm",label:"Stormy"},{value:"fog",label:"Foggy"},{value:"snow",label:"Snowy"}],l=document.getElementById("dropdown");E.forEach(e=>{const t=document.createElement("option");t.value=e.value,t.text=e.label,l.appendChild(t)});const N=document.getElementById("weather-img");l.addEventListener("click",()=>{I(l.value)});I(l.value);function I(e){const t=document.getElementById("body-background"),a=`../${e}.png`;N.setAttribute("src",a);const o="background-img ";e==="sun"?t.setAttribute("class",o+"sun"):e==="snow"?t.setAttribute("class",o+"snow"):e==="fog"?t.setAttribute("class",o+"fog"):e==="rain"?t.setAttribute("class",o+"rain"):t.setAttribute("class",o+"storm")}const L=[];async function P(){const t=await(await fetch("../data/weather_conditions.csv")).text();try{t.split(`
`).forEach(o=>{const n=E.find(s=>o.toLowerCase().includes(s.value)||o.toLowerCase().includes("drizzle")||o.toLowerCase().includes("shower"));n&&L.push({code:o.substring(0,o.indexOf(",")),matchingOption:n.value==="drizzle"||n.value==="shower"?rain:n.value})})}catch(a){console.log(a)}}P();function B(){return L.filter(e=>e.matchingOption===l.options[l.selectedIndex].value)}function y(e){return B().some(a=>a.code==e)}const x="https://wft-geo-db.p.rapidapi.com/v1/geo/cities/",T={method:"GET",headers:{"X-RapidAPI-Key":"5bd5ff9b6fmsh96b605a63af7d22p1a63f1jsncf17219368d7","X-RapidAPI-Host":"wft-geo-db.p.rapidapi.com"}},A="200000";async function S(e){var t;try{const o=await(await fetch(`${x}?namePrefix=${e}&limit=5&minPopulation=${A}`,T)).text(),n=JSON.parse(o);return(t=n==null?void 0:n.data)==null?void 0:t.map(r=>({id:r.wikiDataId,name:r.name,country:r.country,lat:r.latitude,lon:r.longitude}))}catch(a){console.error(a)}}async function M(e,t){var a;try{const n=await(await fetch(`${x}${e}/nearbyCities?radius=${t}&minPopulation=${A}&distanceUnit=mi`,T)).text(),s=JSON.parse(n),r=[];return(a=s==null?void 0:s.data)==null||a.forEach(i=>{r.push({id:i.wikiDataId,name:i.name,country:i.country,lat:i.latitude,lon:i.longitude})}),r}catch(o){console.error(o)}}let m=[],c=[];const d=document.getElementById("city-text-box"),u=document.getElementById("datalist");let p=!1;d.addEventListener("input",()=>{const e=d.value;for(let t=0;t<u.options.length;t++)if(u.options[t].text===e){const o=u.options[t].coords.split(",");c=[o[0].trim(),o[1].trim(),u.options[t].cityId.trim()];return}e.length>1&&!p&&F(e),c=[]});async function F(e){if(!p)try{H(),m=await S(e),m==null||m.forEach(t=>{for(let o=0;o<u.options.length;o++)if(u.options[o].cityId===`${t.id}`)return;const a=document.createElement("option");a.text=`${t.name}, ${t.country}`,a.coords=`${t.lat}, ${t.lon}`,a.cityId=`${t.id}`,u.appendChild(a)})}catch(t){console.log(t)}}function H(){p=!0,setTimeout(()=>{p=!1},600)}B();const W=document.getElementById("submit");W.addEventListener("click",O);const R=document.getElementById("response-body"),z=document.getElementById("forecast-container"),g=z.getElementsByClassName("forecast-day"),w=document.getElementById("forecast-header"),b=document.getElementById("celsius"),j=document.getElementById("fahrenheit");b.addEventListener("change",k);j.addEventListener("change",k);async function O(){if(c==null||c.length===0){f("Please enter a valid city.");return}U();const e=await C(c[0],c[1]),t=e.current.condition.code,a=y(`${t}`),o=l.options[l.selectedIndex].label;if(f(`Searching for the nearest city with ${o} weather...`),a)f(`Woo! Looks like ${d.value} is already ${o}.`),h(e,d.value);else{const n=e.forecast.forecastday[0].day.condition.code;if(y(`${n}`))f(`At some time today, ${d.value} will be ${o}.`),h(e,d.value);else{const r=await M(c[2],"100");for(let i=0;i<r.length;i++){const $=await C(r[i].lat,r[i].lon),v=$.current.condition.code;if(console.log(`${r[i].name} has the weather code ${v}`),y(v)){f(`You can find ${o} weather in the nearby city of ${r[i].name}.`),h($,`${r[i].name}, ${r[i].country}`);return}}f(`No nearby cities with ${o} weather.`),h(e,d.value)}}}function k(){d.value!==""&&O()}function f(e){R.innerHTML=e}function h(e,t){w.innerHTML=`Forecast for ${t}`,w.removeAttribute("hidden");const a=e.forecast.forecastday,o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];for(let n=0;n<a.length;n++)setTimeout(()=>{const s=new Date(a[n].date);q(g[n],o[s.getDay()],b.checked?a[n].day.avgtemp_c:a[n].day.avgtemp_f,a[n].day.condition.text)},n*25)}function q(e,t,a,o){e.getElementsByClassName("day-header")[0].innerHTML=t,b.checked?e.getElementsByClassName("temp")[0].innerHTML=a+" °C":e.getElementsByClassName("temp")[0].innerHTML=a+" °F",e.getElementsByClassName("weather")[0].innerHTML=o,e.removeAttribute("hidden")}function U(){w.setAttribute("hidden","");for(let e=0;e<g.length;e++)g[e].setAttribute("hidden","")}
